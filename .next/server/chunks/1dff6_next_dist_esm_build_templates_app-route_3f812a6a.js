module.exports=[62905,e=>{"use strict";var t=e.i(21347),n=e.i(4483),r=e.i(42707),o=e.i(7157),a=e.i(57085),l=e.i(42638),i=e.i(28123),s=e.i(73873),c=e.i(36011),d=e.i(2538),u=e.i(16591),p=e.i(24432),h=e.i(72920),f=e.i(32160),v=e.i(89104),w=e.i(13303),R=e.i(93695);e.i(54677);var E=e.i(77279),g=e.i(18870),C=e.i(54799),m=e.i(44069);function y(e){return function(t){if(!t.token.startsWith("vercel_blob_client_"))throw new g.BlobError(`${e} must be called with a client token`);if(void 0!==t.addRandomSuffix||void 0!==t.allowOverwrite||void 0!==t.cacheControlMaxAge)throw new g.BlobError(`${e} doesn't allow \`addRandomSuffix\`, \`cacheControlMaxAge\` or \`allowOverwrite\`. Configure these options at the server side when generating client tokens.`)}}async function b(e){return globalThis.crypto.subtle.importKey("raw",new TextEncoder().encode(e),{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}async function U(e,t){if(!globalThis.crypto)return C.createHmac("sha256",t).update(e).digest("hex");let n=await globalThis.crypto.subtle.sign("HMAC",await b(t),new TextEncoder().encode(e));return Buffer.from(new Uint8Array(n)).toString("hex")}async function k({token:e,signature:t,body:n}){if(!globalThis.crypto){let r=C.createHmac("sha256",e).update(n).digest("hex"),o=Buffer.from(r),a=Buffer.from(t);return o.length===a.length&&C.timingSafeEqual(o,a)}return await globalThis.crypto.subtle.verify("HMAC",await b(e),function(e){if(e.length%2!=0)throw RangeError("Expected string to be an even number of characters");let t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=Number.parseInt(e.substring(n,n+2),16);return Buffer.from(t)}(t),new TextEncoder().encode(n))}(0,g.createPutMethod)({allowedOptions:["contentType"],extraChecks:y("client/`put`")}),(0,g.createCreateMultipartUploadMethod)({allowedOptions:["contentType"],extraChecks:y("client/`createMultipartUpload`")}),(0,g.createCreateMultipartUploaderMethod)({allowedOptions:["contentType"],extraChecks:y("client/`createMultipartUpload`")}),(0,g.createUploadPartMethod)({allowedOptions:["contentType"],extraChecks:y("client/`multipartUpload`")}),(0,g.createCompleteMultipartUploadMethod)({allowedOptions:["contentType"],extraChecks:y("client/`completeMultipartUpload`")}),(0,g.createPutMethod)({allowedOptions:["contentType"],extraChecks(e){if(void 0===e.handleUploadUrl)throw new g.BlobError("client/`upload` requires the 'handleUploadUrl' parameter");if(void 0!==e.addRandomSuffix||void 0!==e.createPutExtraChecks||void 0!==e.cacheControlMaxAge)throw new g.BlobError("client/`upload` doesn't allow `addRandomSuffix`, `cacheControlMaxAge` or `allowOverwrite`. Configure these options at the server side when generating client tokens.")},async getToken(e,t){var n,r;return _({handleUploadUrl:t.handleUploadUrl,pathname:e,clientPayload:null!=(n=t.clientPayload)?n:null,multipart:null!=(r=t.multipart)&&r,headers:t.headers})}});async function T({token:e,request:t,body:n,onBeforeGenerateToken:r,onUploadCompleted:o}){var a,l,i,s;let c=(0,g.getTokenFromOptionsOrEnv)({token:e}),d=n.type;switch(d){case"blob.generate-client-token":{let{pathname:e,clientPayload:i,multipart:s}=n.payload,u=await r(e,i,s),p=null!=(a=u.tokenPayload)?a:i,{callbackUrl:h,...f}=u,v=h;o&&!v&&(v=function(e){let t=function(e){try{let t=new URL(e,"https://dummy.com");return t.pathname+t.search}catch{return null}}(e.url);if(!t)return void console.warn("onUploadCompleted provided but no callbackUrl could be determined. Please provide a callbackUrl in onBeforeGenerateToken or set the VERCEL_BLOB_CALLBACK_URL environment variable.");if(process.env.VERCEL_BLOB_CALLBACK_URL)return`${process.env.VERCEL_BLOB_CALLBACK_URL}${t}`;if("1"!==process.env.VERCEL)return void console.warn("onUploadCompleted provided but no callbackUrl could be determined. Please provide a callbackUrl in onBeforeGenerateToken or set the VERCEL_BLOB_CALLBACK_URL environment variable.");if("preview"===process.env.VERCEL_ENV){if(process.env.VERCEL_BRANCH_URL)return`https://${process.env.VERCEL_BRANCH_URL}${t}`;if(process.env.VERCEL_URL)return`https://${process.env.VERCEL_URL}${t}`}if("production"===process.env.VERCEL_ENV&&process.env.VERCEL_PROJECT_PRODUCTION_URL)return`https://${process.env.VERCEL_PROJECT_PRODUCTION_URL}${t}`}(t)),!o&&v&&console.warn("callbackUrl was provided but onUploadCompleted is not defined. The callback will not be handled.");let w=new Date,R=null!=(l=u.validUntil)?l:w.setSeconds(w.getSeconds()+3600);return{type:d,clientToken:await x({...f,token:c,pathname:e,onUploadCompleted:v?{callbackUrl:v,tokenPayload:p}:void 0,validUntil:R})}}case"blob.upload-completed":{let e="x-vercel-signature",r="credentials"in t?null!=(i=t.headers.get(e))?i:"":null!=(s=t.headers[e])?s:"";if(!r)throw new g.BlobError("Missing callback signature");if(!await k({token:c,signature:r,body:JSON.stringify(n)}))throw new g.BlobError("Invalid callback signature");return o&&await o(n.payload),{type:d,response:"ok"}}default:throw new g.BlobError("Invalid event type")}}async function _(e){let{handleUploadUrl:t,pathname:n}=e,r=!function(e){try{return new URL(e),!0}catch(e){return!1}}(t)?new URL(t,location.href).href:t,o={type:"blob.generate-client-token",payload:{pathname:n,clientPayload:e.clientPayload,multipart:e.multipart}},a=await (0,m.fetch)(r,{method:"POST",body:JSON.stringify(o),headers:{"content-type":"application/json",...e.headers},signal:e.abortSignal});if(!a.ok)throw new g.BlobError("Failed to  retrieve the client token");try{let{clientToken:e}=await a.json();return e}catch(e){throw new g.BlobError("Failed to retrieve the client token")}}async function x({token:e,...t}){var n;let r=new Date;r.setSeconds(r.getSeconds()+30);let o=(0,g.getTokenFromOptionsOrEnv)({token:e}),[,,,a=null]=o.split("_");if(!a)throw new g.BlobError(e?"Invalid `token` parameter":"Invalid `BLOB_READ_WRITE_TOKEN`");let l=Buffer.from(JSON.stringify({...t,validUntil:null!=(n=t.validUntil)?n:r.getTime()})).toString("base64"),i=await U(l,o);if(!i)throw new g.BlobError("Unable to sign client token");return`vercel_blob_client_${a}_${Buffer.from(`${i}.${l}`).toString("base64")}`}var O=e.i(44747);async function A(e){console.log("[v0] Upload token request received"),console.log("[v0] Environment check - BLOB_READ_WRITE_TOKEN exists:",!!process.env.BLOB_READ_WRITE_TOKEN);try{let t=await e.json();console.log("[v0] Request body:",JSON.stringify(t));let n=await T({body:t,request:e,onBeforeGenerateToken:async(e,t)=>{if(console.log("[v0] Generating token for:",e),console.log("[v0] Client payload:",t),!e.endsWith(".pdf"))throw Error("Only PDF files are allowed");return{allowedContentTypes:["application/pdf"],maximumSizeInBytes:0x3200000}},onUploadCompleted:async({blob:e,tokenPayload:t})=>{console.log("[v0] Upload completed:",e.url),console.log("[v0] Token payload:",t)}});return console.log("[v0] Token generated successfully"),O.NextResponse.json(n)}catch(e){return console.error("[v0] Token generation error:",e),console.error("[v0] Error stack:",e.stack),O.NextResponse.json({error:e.message},{status:400})}}e.s(["POST",()=>A,"runtime",0,"nodejs"],83839);var B=e.i(83839);let L=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/upload-token/route",pathname:"/api/upload-token",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/upload-token/route.ts",nextConfigOutput:"",userland:B}),{workAsyncStorage:P,workUnitAsyncStorage:S,serverHooks:N}=L;function M(){return(0,r.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:S})}async function I(e,t,r){L.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/upload-token/route";g=g.replace(/\/index$/,"")||"/";let C=await L.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!C)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:m,params:y,nextConfig:b,parsedUrl:U,isDraftMode:k,prerenderManifest:T,routerServerContext:_,isOnDemandRevalidate:x,revalidateOnlyGenerated:O,resolvedPathname:A,clientReferenceManifest:B,serverActionsManifest:P}=C,S=(0,s.normalizeAppPath)(g),N=!!(T.dynamicRoutes[S]||T.routes[A]),M=async()=>((null==_?void 0:_.render404)?await _.render404(e,t,U,!1):t.end("This page could not be found"),null);if(N&&!k){let e=!!T.routes[A],t=T.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await M();throw new R.NoFallbackError}}let I=null;!N||L.isDev||k||(I="/index"===(I=A)?"/":I);let H=!0===L.isDev||!N,$=N&&!H;P&&B&&(0,l.setReferenceManifestsSingleton)({page:g,clientReferenceManifest:B,serverActionsManifest:P,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:P})});let D=e.method||"GET",q=(0,a.getTracer)(),V=q.getActiveScopeSpan(),K={params:y,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r)=>L.onRequestError(e,t,r,_)},sharedContext:{buildId:m}},j=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(j,(0,d.signalFromNodeResponse)(t));try{let l=async e=>L.handle(G,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=q.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${D} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${g}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),s=async o=>{var a,s;let c=async({previousCacheEntry:n})=>{try{if(!i&&x&&O&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await l(o);e.fetchMetrics=K.renderOpts.fetchMetrics;let s=K.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let c=K.renderOpts.collectedTags;if(!N)return await (0,h.sendResponse)(j,F,a,K.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[w.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,r=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==n?void 0:n.isStale)&&await L.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:x})},_),t}},d=await L.handleResponse({req:e,nextConfig:b,cacheKey:I,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:i});if(!N)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(s=d.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",x?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),k&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&N||u.delete(w.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,v.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(j,F,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};V?await s(V):await q.withPropagatedContext(e.headers,()=>q.trace(u.BaseServerSpan.handleRequest,{spanName:`${D} ${g}`,kind:a.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},s))}catch(t){if(t instanceof R.NoFallbackError||await L.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:x})}),N)throw t;return await (0,h.sendResponse)(j,F,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>M,"routeModule",()=>L,"serverHooks",()=>N,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>S],62905)}];

//# sourceMappingURL=1dff6_next_dist_esm_build_templates_app-route_3f812a6a.js.map